(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{6367:function(e,t,a){Promise.resolve().then(a.bind(a,1384))},1384:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return w}});var s=a(3827),r=a(4090),n=a(989),i=a(5660),o=a(6431),c=a(7210),d=a(8580),l=a(206),u=a(6796),m=a(4350);let p={bundlerUrl:"http://localhost:3001/rpc",rpcUrl:"https://sepolia.base.org",chainId:parseInt("84532"),entryPointAddress:"0x5FF137D4b0FDCD49DcA30c7CF57E578a026d2789",factoryAddress:"0xe52553Fa5Cb212017b040c3678da2EC282963167",paymasterAddress:"0x30a426c96f2F08d3fa29a3c350D1b01E16F5a6B5",usdcAddress:"0x036CbD53842c5426634e7929541eC2318f3dCF7e"},h=[{inputs:[{name:"owner",type:"address"},{name:"salt",type:"uint256"}],name:"getAccountAddress",outputs:[{name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{name:"owner",type:"address"},{name:"salt",type:"uint256"}],name:"isAccountDeployed",outputs:[{name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[{name:"owner",type:"address"},{name:"salt",type:"uint256"}],name:"createAccount",outputs:[{name:"account",type:"address"}],stateMutability:"nonpayable",type:"function"}],y=[{inputs:[{name:"sender",type:"address"},{name:"key",type:"uint192"}],name:"getNonce",outputs:[{name:"nonce",type:"uint256"}],stateMutability:"view",type:"function"}],g=[{inputs:[{name:"target",type:"address"},{name:"value",type:"uint256"},{name:"data",type:"bytes"}],name:"execute",outputs:[],stateMutability:"nonpayable",type:"function"}],x=[{inputs:[{name:"account",type:"address"}],name:"balanceOf",outputs:[{name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{name:"to",type:"address"},{name:"amount",type:"uint256"}],name:"transfer",outputs:[{name:"",type:"bool"}],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"decimals",outputs:[{name:"",type:"uint8"}],stateMutability:"view",type:"function"}],b=(0,i.v)({chain:m.L,transport:(0,o.d)(p.rpcUrl)});class f{async connect(){if(!window.ethereum)throw Error("MetaMask is not installed");let e=await window.ethereum.request({method:"eth_requestAccounts"});if(!e||0===e.length)throw Error("No accounts found");if(parseInt(await window.ethereum.request({method:"eth_chainId"}),16)!==p.chainId)try{await window.ethereum.request({method:"wallet_switchEthereumChain",params:[{chainId:"0x"+p.chainId.toString(16)}]})}catch(e){if(4902===e.code)await window.ethereum.request({method:"wallet_addEthereumChain",params:[{chainId:"0x"+p.chainId.toString(16),chainName:"Base Sepolia",nativeCurrency:{name:"ETH",symbol:"ETH",decimals:18},rpcUrls:["https://sepolia.base.org"],blockExplorerUrls:["https://sepolia.basescan.org"]}]});else throw e}return this.owner=e[0],this.smartAccountAddress=await this.getSmartAccountAddress(this.owner),{owner:this.owner,smartAccount:this.smartAccountAddress}}async getSmartAccountAddress(e){return await b.readContract({address:p.factoryAddress,abi:h,functionName:"getAccountAddress",args:[e,0n]})}async isAccountDeployed(){if(!this.smartAccountAddress)throw Error("Not connected");let e=await b.getCode({address:this.smartAccountAddress});return void 0!==e&&"0x"!==e}async getSmartAccountBalance(){if(!this.smartAccountAddress)throw Error("Not connected");return await b.getBalance({address:this.smartAccountAddress})}async getUsdcBalance(){if(!this.smartAccountAddress)throw Error("Not connected");return await b.readContract({address:p.usdcAddress,abi:x,functionName:"balanceOf",args:[this.smartAccountAddress]})}async getNonce(){if(!this.smartAccountAddress)throw Error("Not connected");return await b.readContract({address:p.entryPointAddress,abi:y,functionName:"getNonce",args:[this.smartAccountAddress,0n]})}buildInitCode(){if(!this.owner)throw Error("Not connected");let e=(0,c.R)({abi:h,functionName:"createAccount",args:[this.owner,0n]});return"".concat(p.factoryAddress).concat(e.slice(2))}buildTransferCallData(e,t){return(0,c.R)({abi:g,functionName:"execute",args:[e,t,"0x"]})}buildUsdcTransferCallData(e,t){let a=(0,c.R)({abi:x,functionName:"transfer",args:[e,t]});return(0,c.R)({abi:g,functionName:"execute",args:[p.usdcAddress,0n,a]})}async estimateGas(e){let t=await fetch(p.bundlerUrl,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jsonrpc:"2.0",id:1,method:"eth_estimateUserOperationGas",params:[{sender:e.sender,nonce:e.nonce?"0x"+e.nonce.toString(16):"0x0",initCode:e.initCode||"0x",callData:e.callData||"0x",paymasterAndData:e.paymasterAndData||"0x",signature:"0x"},p.entryPointAddress]})}),a=await t.json();if(a.error)throw Error(a.error.message);return a.result}async buildUserOperation(e,t){if(!this.owner||!this.smartAccountAddress)throw Error("Not connected");let a=await this.isAccountDeployed()?"0x":this.buildInitCode(),s=this.buildTransferCallData(e,t),r=await this.getNonce(),n=await this.estimateGas({sender:this.smartAccountAddress,nonce:r,initCode:a,callData:s,paymasterAndData:p.paymasterAddress});return{sender:this.smartAccountAddress,nonce:r,initCode:a,callData:s,callGasLimit:BigInt(n.callGasLimit),verificationGasLimit:BigInt(n.verificationGasLimit),preVerificationGas:BigInt(n.preVerificationGas),maxFeePerGas:BigInt(n.maxFeePerGas),maxPriorityFeePerGas:BigInt(n.maxPriorityFeePerGas),paymasterAndData:p.paymasterAddress,signature:"0x"}}async buildUserOperationUsdc(e,t){if(!this.owner||!this.smartAccountAddress)throw Error("Not connected");let a=await this.isAccountDeployed()?"0x":this.buildInitCode(),s=this.buildUsdcTransferCallData(e,t),r=await this.getNonce(),n=await this.estimateGas({sender:this.smartAccountAddress,nonce:r,initCode:a,callData:s,paymasterAndData:p.paymasterAddress});return{sender:this.smartAccountAddress,nonce:r,initCode:a,callData:s,callGasLimit:BigInt(n.callGasLimit),verificationGasLimit:BigInt(n.verificationGasLimit),preVerificationGas:BigInt(n.preVerificationGas),maxFeePerGas:BigInt(n.maxFeePerGas),maxPriorityFeePerGas:BigInt(n.maxPriorityFeePerGas),paymasterAndData:p.paymasterAddress,signature:"0x"}}async buildDeployUserOperation(){if(!this.owner||!this.smartAccountAddress)throw Error("Not connected");if(await this.isAccountDeployed())throw Error("Account is already deployed");let e=this.buildInitCode(),t=await this.getNonce(),a=await this.estimateGas({sender:this.smartAccountAddress,nonce:t,initCode:e,callData:"0x",paymasterAndData:p.paymasterAddress});return{sender:this.smartAccountAddress,nonce:t,initCode:e,callData:"0x",callGasLimit:BigInt(a.callGasLimit),verificationGasLimit:BigInt(a.verificationGasLimit),preVerificationGas:BigInt(a.preVerificationGas),maxFeePerGas:BigInt(a.maxFeePerGas),maxPriorityFeePerGas:BigInt(a.maxPriorityFeePerGas),paymasterAndData:p.paymasterAddress,signature:"0x"}}getUserOpHash(e){let t=(0,d.E)([{type:"address"},{type:"uint256"},{type:"bytes32"},{type:"bytes32"},{type:"uint256"},{type:"uint256"},{type:"uint256"},{type:"uint256"},{type:"uint256"},{type:"bytes32"}],[e.sender,e.nonce,(0,l.w)(e.initCode),(0,l.w)(e.callData),e.callGasLimit,e.verificationGasLimit,e.preVerificationGas,e.maxFeePerGas,e.maxPriorityFeePerGas,(0,l.w)(e.paymasterAndData)]),a=(0,l.w)(t);return(0,l.w)((0,d.E)([{type:"bytes32"},{type:"address"},{type:"uint256"}],[a,p.entryPointAddress,BigInt(p.chainId)]))}async signUserOperation(e){if(!this.owner)throw Error("Not connected");let t=this.getUserOpHash(e),a=await window.ethereum.request({method:"personal_sign",params:[t,this.owner]});return{...e,signature:a}}async sendUserOperation(e){let t=await fetch(p.bundlerUrl,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jsonrpc:"2.0",id:1,method:"eth_sendUserOperation",params:[{sender:e.sender,nonce:"0x"+e.nonce.toString(16),initCode:e.initCode,callData:e.callData,callGasLimit:"0x"+e.callGasLimit.toString(16),verificationGasLimit:"0x"+e.verificationGasLimit.toString(16),preVerificationGas:"0x"+e.preVerificationGas.toString(16),maxFeePerGas:"0x"+e.maxFeePerGas.toString(16),maxPriorityFeePerGas:"0x"+e.maxPriorityFeePerGas.toString(16),paymasterAndData:e.paymasterAndData,signature:e.signature},p.entryPointAddress]})}),a=await t.json();if(a.error)throw Error(a.error.message);return a.result}async waitForUserOperation(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:6e4,a=Date.now();for(;Date.now()-a<t;){let t=await fetch(p.bundlerUrl,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jsonrpc:"2.0",id:1,method:"eth_getUserOperationReceipt",params:[e]})}),a=await t.json();if(a.result)return a.result;await new Promise(e=>setTimeout(e,2e3))}throw Error("Timeout waiting for UserOperation")}async transferNative(e,t){let a=(0,u.f)(t),s=await this.buildUserOperation(e,a),r=await this.signUserOperation(s),n=await this.sendUserOperation(r),i=await this.waitForUserOperation(n);return{userOpHash:n,receipt:i}}getOwner(){return this.owner}getSmartAccount(){return this.smartAccountAddress}constructor(){this.owner=null,this.smartAccountAddress=null}}function w(){let[e]=(0,r.useState)(()=>new f),[t,a]=(0,r.useState)("idle"),[i,o]=(0,r.useState)(null),[c,d]=(0,r.useState)(null),[l,u]=(0,r.useState)(null),[m,h]=(0,r.useState)(0n),[y,g]=(0,r.useState)(!1),[x,b]=(0,r.useState)(""),[w,A]=(0,r.useState)(""),[N,j]=(0,r.useState)(null),[C,v]=(0,r.useState)(null),D=(0,r.useCallback)(async()=>{if(l)try{let t=await e.getUsdcBalance();h(t);let a=await e.isAccountDeployed();g(a)}catch(e){console.error("Error refreshing balance:",e)}},[e,l]);(0,r.useEffect)(()=>{if("connected"===t||"success"===t){D();let e=setInterval(D,1e4);return()=>clearInterval(e)}},[t,D]);let G=async()=>{a("connecting"),o(null);try{let{owner:t,smartAccount:s}=await e.connect();d(t),u(s);let r=await e.getUsdcBalance();h(r);let n=await e.isAccountDeployed();g(n),a("connected")}catch(e){o(e instanceof Error?e.message:"Failed to connect"),a("error")}},S=async()=>{if(!x||!w){o("Please enter recipient and amount");return}if(!x.match(/^0x[a-fA-F0-9]{40}$/)){o("Invalid recipient address");return}o(null),j(null),v(null);try{a("building");let t=BigInt(Math.floor(1e6*parseFloat(w))),s=await e.buildUserOperationUsdc(x,t);a("signing");let r=await e.signUserOperation(s);a("sending");let n=await e.sendUserOperation(r);j(n),a("confirming");let i=await e.waitForUserOperation(n);if(v(i.receipt.transactionHash),i.success)a("success"),b(""),A(""),D();else throw Error("UserOperation failed on-chain")}catch(e){console.error("Transfer error:",e),o(e instanceof Error?e.message:"Transfer failed"),a("error")}},U=e=>"".concat(e.slice(0,6),"...").concat(e.slice(-4)),P=()=>{switch(t){case"connecting":return"Connecting to MetaMask...";case"building":return"Building UserOperation...";case"signing":return"Sign the message in MetaMask...";case"sending":return"Sending to bundler...";case"confirming":return"Waiting for confirmation...";default:return null}};return(0,s.jsx)("div",{className:"min-h-screen flex items-center justify-center p-4",children:(0,s.jsxs)("div",{className:"bg-gray-800 rounded-2xl shadow-xl p-8 w-full max-w-md",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold text-center mb-2",children:"Gasless USDC Transfers"}),(0,s.jsx)("p",{className:"text-gray-400 text-center text-sm mb-6",children:"ERC-4337 on Base Sepolia"}),"idle"===t||"error"===t?(0,s.jsxs)("div",{children:[(0,s.jsx)("button",{onClick:G,className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-4 rounded-lg transition-colors",children:"Connect MetaMask"}),"error"===t&&i&&(0,s.jsx)("p",{className:"text-red-400 text-sm mt-4 text-center",children:i})]}):"connecting"===t?(0,s.jsx)("div",{className:"text-center text-gray-400",children:(0,s.jsx)("div",{className:"animate-pulse",children:"Connecting to MetaMask..."})}):(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("div",{className:"bg-gray-700 rounded-lg p-4",children:[(0,s.jsx)("p",{className:"text-gray-400 text-xs mb-1",children:"Your EOA"}),(0,s.jsx)("p",{className:"font-mono text-sm",children:c&&U(c)})]}),(0,s.jsxs)("div",{className:"bg-gray-700 rounded-lg p-4",children:[(0,s.jsxs)("p",{className:"text-gray-400 text-xs mb-1",children:["Smart Account"," ",y?(0,s.jsx)("span",{className:"text-green-400",children:"(Deployed)"}):(0,s.jsx)("span",{className:"text-yellow-400",children:"(Not deployed yet)"})]}),(0,s.jsx)("p",{className:"font-mono text-sm break-all",children:l})]}),(0,s.jsxs)("div",{className:"bg-gray-700 rounded-lg p-4",children:[(0,s.jsx)("p",{className:"text-gray-400 text-xs mb-1",children:"USDC Balance"}),(0,s.jsxs)("p",{className:"text-xl font-semibold",children:[(0,n.b)(m,6)," USDC"]})]})]}),!y&&(0,s.jsxs)("div",{className:"bg-yellow-900/50 border border-yellow-600 rounded-lg p-4 mb-4",children:[(0,s.jsx)("p",{className:"text-yellow-400 font-semibold mb-2",children:"Account Deployment Required"}),(0,s.jsx)("p",{className:"text-yellow-200 text-sm mb-3",children:"You must deploy your smart account before you can send transactions."}),(0,s.jsx)("button",{onClick:async()=>{if("building"!==t&&"signing"!==t&&"sending"!==t&&"confirming"!==t){o(null),j(null),v(null);try{a("building");let t=await e.buildDeployUserOperation();a("signing");let s=await e.signUserOperation(t);a("sending");let r=await e.sendUserOperation(s);j(r),a("confirming");let n=await e.waitForUserOperation(r);if(v(n.receipt.transactionHash),n.success)a("success"),g(!0),D();else throw Error("Deployment failed on-chain")}catch(e){console.error("Deployment error:",e),o(e instanceof Error?e.message:"Deployment failed"),a("error")}}},disabled:"connected"!==t&&"success"!==t,className:"w-full bg-yellow-600 hover:bg-yellow-700 disabled:bg-gray-600 disabled:cursor-not-allowed text-white font-bold py-2 px-4 rounded transition-colors",children:"Deploy Smart Account"})]}),y&&0n===m&&(0,s.jsxs)("div",{className:"bg-blue-900/50 border border-blue-600 rounded-lg p-4",children:[(0,s.jsx)("p",{className:"text-blue-400 text-sm",children:(0,s.jsx)("strong",{children:"Send USDC to your Smart Account:"})}),(0,s.jsx)("p",{className:"font-mono text-xs mt-2 break-all text-blue-200",children:l}),(0,s.jsxs)("p",{className:"text-blue-400/80 text-xs mt-2",children:["USDC Contract: ",U(p.usdcAddress)]}),(0,s.jsx)("p",{className:"text-blue-400/80 text-xs mt-1",children:"Send USDC to the Smart Account address above."})]}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-gray-400 text-sm mb-2",children:"Recipient Address"}),(0,s.jsx)("input",{type:"text",value:x,onChange:e=>b(e.target.value),placeholder:"0x...",className:"w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-3 text-white placeholder-gray-500 focus:outline-none focus:border-blue-500",disabled:"connected"!==t&&"success"!==t})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-gray-400 text-sm mb-2",children:"Amount (USDC)"}),(0,s.jsx)("input",{type:"number",value:w,onChange:e=>A(e.target.value),placeholder:"10.00",step:"0.01",min:"0",className:"w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-3 text-white placeholder-gray-500 focus:outline-none focus:border-blue-500",disabled:"connected"!==t&&"success"!==t})]}),(0,s.jsx)("button",{onClick:S,disabled:"connected"!==t&&"success"!==t||!y||0n===m,className:"w-full bg-green-600 hover:bg-green-700 disabled:bg-gray-600 disabled:cursor-not-allowed text-white font-semibold py-3 px-4 rounded-lg transition-colors",children:"Send USDC (Gasless)"})]}),P()&&(0,s.jsx)("div",{className:"bg-blue-900/50 border border-blue-600 rounded-lg p-4",children:(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-400"}),(0,s.jsx)("p",{className:"text-blue-400 text-sm",children:P()})]})}),"success"===t&&C&&(0,s.jsxs)("div",{className:"bg-green-900/50 border border-green-600 rounded-lg p-4",children:[(0,s.jsx)("p",{className:"text-green-400 font-semibold mb-2",children:"Transfer Successful!"}),(0,s.jsx)("a",{href:"https://sepolia.basescan.org/tx/".concat(C),target:"_blank",rel:"noopener noreferrer",className:"text-blue-400 hover:underline text-sm break-all",children:"View on BaseScan"})]})]}),(0,s.jsx)("p",{className:"text-gray-500 text-xs text-center mt-6",children:"Self-hosted Bundler + Paymaster"})]})})}}},function(e){e.O(0,[936,971,69,744],function(){return e(e.s=6367)}),_N_E=e.O()}]);